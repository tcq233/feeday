åˆ é™¤é‡å¤å›¾åƒ-GPU
```
import os
import sys
import subprocess
from concurrent.futures import ThreadPoolExecutor, as_completed

# ========== è‡ªåŠ¨å®‰è£…ä¾èµ–ï¼ˆé˜¿é‡Œæºï¼‰ ==========
def auto_install(pkg):
    try:
        __import__(pkg)
    except ImportError:
        print(f"ğŸ“¦ æœªå®‰è£… {pkg}ï¼Œæ­£åœ¨å®‰è£…ï¼ˆé˜¿é‡Œæºï¼‰...")
        subprocess.check_call([
            sys.executable, "-m", "pip", "install", pkg,
            "-i", "https://mirrors.aliyun.com/pypi/simple"
        ])

auto_install("PIL")              # pillow
auto_install("imagehash")
auto_install("opencv-python")
auto_install("numpy")
auto_install("scikit-image")


import cv2
import numpy as np
from PIL import Image
import imagehash
from skimage.metrics import structural_similarity as ssim


# ============ é…ç½® ============
FOLDER = r"C:\Users\Puck\Desktop\xz\cp"
EXTS = {".jpg", ".jpeg", ".png", ".bmp", ".webp"}

PHASH_THRESHOLD = 5     # phash æœ€å¤§å·®è·
DHASH_THRESHOLD = 5     # dhash æœ€å¤§å·®è·
SSIM_THRESHOLD = 0.95   # fast-ssim æœ€ç»ˆç¡®è®¤é˜ˆå€¼

THREADS = 8
# =============================


def load_image(path):
    """è¯»å›¾ï¼ˆOpenCV æ ¼å¼ + Original Sizeï¼‰"""
    img = cv2.imdecode(np.fromfile(path, dtype=np.uint8), cv2.IMREAD_COLOR)
    return img


def fast_ssim(img1, img2):
    """ç¼©å°åˆ° 64Ã—64ï¼Œå†è®¡ç®— SSIMï¼ˆé«˜é€Ÿ + ä¸è¯¯åˆ¤ï¼‰"""
    gray1 = cv2.cvtColor(img1, cv2.COLOR_BGR2GRAY)
    gray2 = cv2.cvtColor(img2, cv2.COLOR_BGR2GRAY)

    h = min(gray1.shape[0], gray2.shape[0])
    w = min(gray1.shape[1], gray2.shape[1])

    g1 = cv2.resize(gray1, (64, 64))
    g2 = cv2.resize(gray2, (64, 64))

    value, _ = ssim(g1, g2, full=True)
    return value


def calc_hashes(path):
    """è®¡ç®— pHash + dHash"""
    try:
        img = Image.open(path).convert("RGB")
        ph = imagehash.phash(img)
        dh = imagehash.dhash(img)
        return (path, ph, dh)
    except:
        return (path, None, None)


def main():
    print("ğŸ“Œ æ‰«ææ–‡ä»¶ä¸­...")

    file_list = []
    for root, _, files in os.walk(FOLDER):
        for f in files:
            if os.path.splitext(f)[1].lower() in EXTS:
                file_list.append(os.path.join(root, f))

    print(f"ğŸ“¸ æ‰¾åˆ° {len(file_list)} å¼ å›¾ç‰‡ï¼Œå¼€å§‹å¤šçº¿ç¨‹ hash...")

    # ========== å¤šçº¿ç¨‹ hash ==========
    hashes = []
    with ThreadPoolExecutor(max_workers=THREADS) as exe:
        futures = [exe.submit(calc_hashes, p) for p in file_list]
        for f in as_completed(futures):
            hashes.append(f.result())

    # ========== åŠ è½½ OpenCV å›¾åƒ & åˆ†è¾¨ç‡ ==========
    print("ğŸ“· åŠ è½½å›¾åƒç”¨äº SSIM...")

    imgs = {}
    resolutions = {}

    for path, _, _ in hashes:
        img = load_image(path)
        if img is None:
            continue
        imgs[path] = img
        h, w = img.shape[:2]
        resolutions[path] = w * h

    print("ğŸš€ å¼€å§‹ä¸¥æ ¼å»é‡ï¼ˆä¸‰é‡åˆ¤å®šï¼Œä¸è¯¯åˆ ï¼‰...")

    delete = set()
    kept = []

    n = len(hashes)

    for i in range(n):
        p1, ph1, dh1 = hashes[i]
        if p1 in delete:
            continue

        kept.append(p1)

        for j in range(i + 1, n):
            p2, ph2, dh2 = hashes[j]
            if p2 in delete:
                continue

            # --- 1) pHash ç²—ç­› ---
            if ph1 - ph2 > PHASH_THRESHOLD:
                continue

            # --- 2) dHash ç²—ç­› ---
            if dh1 - dh2 > DHASH_THRESHOLD:
                continue

            # --- 3) fast SSIM æœ€ç»ˆç¡®è®¤ ---
            s = fast_ssim(imgs[p1], imgs[p2])

            if s >= SSIM_THRESHOLD:
                # ä¿ç•™åˆ†è¾¨ç‡æœ€é«˜
                if resolutions[p2] > resolutions[p1]:
                    print(f"ğŸ”„ æ›¿æ¢ä¿ç•™ â†’ {p2}ï¼ˆæ›´é«˜æ¸…ï¼‰")
                    delete.add(p1)
                    kept[-1] = p2
                    p1 = p2
                else:
                    print(f"ğŸ—‘ åˆ é™¤ï¼š{p2}ï¼ˆSSIM={s:.3f}ï¼‰")
                    delete.add(p2)

    print(f"\nğŸ—‘ åˆ é™¤ {len(delete)} å¼ é‡å¤å›¾ç‰‡...")

    # æœ€ç»ˆåˆ é™¤
    for p in delete:
        try:
            os.remove(p)
        except:
            pass

    print("âœ¨ å®Œæˆï¼")


if __name__ == "__main__":
    main()

```